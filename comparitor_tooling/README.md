README
------

Antigen labelled references
----------------
Different antigen labelled references were employed to compare the influence of the dataset used for TCR clustering. 
- Tcrvalid: Is the reference used in our publication
- gliph: Is the reference from GLIPH2 publication
- gliphHQ: Is the reference from GLIPH2 publication after filtering out all the TCR-Antigen pairs labelled as low quality (VDJDB quality 0)

Spike in dataset
----------------
The spike in splits are generated by randomly sampling the reference TCRs used for spike ins in GLIPH2 publication. 10 replicates per spike in fold are generated and indexed in the following fashion:
Sx_y where x is the spike in fold and y the replicate index.
The spike splots are saved into tcrvalid/data/Spike_splits

Spike in scoring
----------------
In order to emulate spike in with irrelevant TCRs we labelled each spike in TCRs as binding with a unique epitope. In this way if they are included into any TCR cluster from the antigen labelled TCR reference its purity decreases.
This approach is quite stringent on the clustering tools as it is possible that the irrelevvant spike in TCRs do bind the same epitope as the TCRs it is clustering with but it is yet to be annotated. Equally clusters of spike in TCRs could bind the same epitope that is not labelled in our reference set but would be scored as an unpure cluster as both their epitope labels would be unique.

 - The scoring is undertaken for all spike in folds and repeats for ismart, tcrdist2 and tcrvalid in the comaparitor\_tooling/Spikein\_scores/Wrapper.ipynb
 - The scoring for clustcr for all spike in folds is undertaken in comparitor_tooling/clustcr/clustcr_spike\_in\_score.ipynb

All the spike in scoring is undertaken by scanning their respective "radius" parameter be it eps for all DBScan clustering or "threshold" values for ismart. 
All the scoring outputs are saved in their respective folders with the format: Spikein\_scores/MethodReference 
With Method the clustering tool and reference the labelled antigen reference used.

 - All the scoring csvs are then collated into tcrvalid/comparitor_tooling/master\_score\_meta.csv for plotting purposes. The collating of the scoring csvs is undertaken in Master\_scoring\_generator.ipynb.


Spike in output plotting 
----------------
The figure generation to compare spike ins employing the same scoring scheme are presented in Spike\_in\_plotting.ipynb and saved into comparitor\_tooling/Figure_output

One-Hot encoding vs Physiochemical featurization clustering
----------------
The TCR-Antigen reference data sets are featurized either by One-Hot or Physiochemical features, then reduced to 16D via PCA. 
The reduced representations are then clustered using DBscan and saved as 1HOTvsPC\_score.csv

GLIPH2 clustering (via webtool)
----------------
GLIPH2 clustering is undertaken via the webtool. Spike in TCRs are combined with reference labelled TCRs as for other methods. The TCRs are then formatted accoring to the webtools guidance and run with Reference CD48 V1. The combined TCR spike splits for the GLIPH tool can be found in tcrvalid/data/Pre_data_GLIPH. 
The GLIPH output is saved in /Spikein\_scores/GLIPH\_webtool\_output/GLIPH_output/Ref48_V1/
In order to provide consistent benchmarking of all TCR clustering approaches the GLIPH web output is processed in the Process_GLIPH_output.ipynb
A key processing step for GLIPH output was removing double indexed TCRs. Many TCR clustering tools will only assign TCRs to a single cluster but GLIPH assigns them to multiple distinct clusters. In order to address this we only kept unique TCRs in clustering output (keeping each TCRs occurence in the largest cluster it is a member of), followed by removing all clusters that now consist of a single TCR due to the dropping of the replicates. 
This processing is refered to as Doublecounting in our downstream analysis.

clusTCR clustering
----------------
For clustcr we provide instructions and scripts to wrap clustcr in comparitor\_tooling/clustcr
The clustering spike in benchmarking is undertaken in clustcr\_spike\_in\_score.ipynb

distance-based (iSMART, tcr-dist)
----------------

distance\based\tools contains wappers around tcr-dist and iSMART for running clustering with those tools.

Additional feature are provided for tuning the radius of clustering for tcr-dist, extracting the clustering from the tcr-dist images, and DBscan on the distance matrix.

See inside distance\based\tools for further details on setting up the environments and tools, an example is provided in example\_distance\_baseed\runs.py. 

deepTCR VAE
-----------

For DeepTCR for clustering via VAE we provide scripts for training and calculating VAE latent spac features for different conditions. We additionally calculate features from VAE for the purpose of a downstream classification task. For clustering, an example notebook showing clustering with DBSCAN onto the deepTCR VAE features is provided.

A conda env file is provided, which is require for running the VAE feature extraction tools (clusetring ipynb runs under normal tcrvalid install environment). Note that deepTCTR VAE inference requires >40Gb of RAM.
